# 美味效率指数 (DEI) 研究一：实证结果报告

## 一、研究概述

**研究目标**: 构建首个融合食物味觉享受（Hedonic value, H）与环境代价（Environmental cost, E）的综合指标——美味效率指数 (Deliciousness Efficiency Index, DEI)，量化"每单位环境代价所获得的美味体验"。

**核心公式**（对数形式，主规格）:
$$\log(\text{DEI}) = \log H(f) - \log E(f)$$

- H(f): 菜品 f 的享乐评分 (1-10 量表)，基于**领域微调 BERT 模型**从餐厅评论中提取
- E(f): 菜品 f 的环境综合代价（碳排放 + 水足迹 + 能耗，归一化等权加权）
- 对数变换使 H 和 E 的贡献在加法尺度上可比，避免原始比值 H/E 被 E 的高方差主导

**稳健性替代规格**:
$$\text{DEI}_z = Z(H) - Z(E)$$

其中 $Z(\cdot)$ 为标准化（零均值、单位方差），确保 H 和 E 在无量纲尺度上等权贡献。

---

## 二、数据规模

| 指标 | 数值 |
|------|------|
| Yelp 餐厅总数 | 70,617 家 |
| Yelp 评论总数 | 5,309,210 条 |
| 覆盖菜系 | 13 个（中、日、意、墨、印、法、美、泰、韩、地中海、越南、西班牙、其他） |
| 菜品词典规模 | 158 道菜，387 个别名 |
| 菜品提及总数 | 4,427,680 条 |
| NLP 情感评分样本 | 76,927 条（每道菜最多 500 条） |
| LLM 标注训练集 | 1,896 条（DeepSeek v3.2），1,096 条有效 (score 1-10) |
| BERT 微调模型 | bert-base-uncased → 回归（验证集 MAE=1.08, dish r=0.84） |
| 具有完整 DEI 计算的菜品 | **158 道（100%）** |
| 食材环境因子数据库 | 101 种食材（来源：Poore & Nemecek 2018, Agribalyse 3.1, WFN） |
| 烹饪方式能耗数据 | 15 种 |

---

## 三、H 分数微调管线

### 3.1 问题与动机

基线方案使用预训练通用情感模型（nlptown/bert-base-multilingual-uncased-sentiment，5-star → 1-10 线性映射）。该模型未针对食物味觉体验训练，可能混淆服务、氛围等非味觉因素。

### 3.2 LLM 标注

- 使用 DeepSeek v3.2（via OpenRouter API）标注 1,896 条评论
- Prompt 要求：仅评估食物的味道/质感/外观，排除服务、价格、氛围
- 有效标注（score 1-10）：1,096 条 (57.8%)，覆盖 157 道菜
- 无效标注（score=0，信息不足/不相关）：800 条 (42.2%)

### 3.3 BERT 微调

| 指标 | 数值 |
|------|------|
| 训练集 | 891 条 |
| 验证集 | 205 条 |
| MAE（评论级） | 1.082 |
| RMSE | 1.468 |
| Pearson r（评论级） | 0.729 |
| Spearman rho | 0.558 |
| **Dish-level Pearson r** | **0.844** |
| Mean bias | +0.344 |

### 3.4 微调 vs 预训练对比

| 指标 | 值 |
|------|---|
| Dish-level Pearson r | 0.891 |
| Dish-level Spearman rho | 0.849 |
| 均值偏移 | -0.368（微调更保守） |
| 预训练 H 范围 | [5.70, 8.11] |
| 微调 H 范围 | [6.05, 7.57]（方差缩小） |
| 跨 quintile 变动菜品 | 仅 4 道 (2.5%) |

**结论**: 微调模型与预训练模型高度一致（r=0.89），但微调模型的 H 分数范围更窄（标准差更小），反映出剥离了非味觉因素后的更纯净的味觉信号。

---

## 四、方差分解与方法论透明性

### 4.1 核心问题

原始 DEI = H/E 中，E 的跨菜品变异远大于 H，导致 DEI 排名几乎完全由 E 驱动。使用 log 变换后:

$$\text{Var}(\log\text{DEI}) = \text{Var}(\log H) + \text{Var}(\log E) - 2\text{Cov}(\log H, \log E)$$

### 4.2 方差分解结果

| 成分 | 值 | 对 Var(log DEI) 贡献 |
|------|---|-------------------|
| Var(log H) | 0.00155 | **0.8%** |
| Var(log E) | 0.5995 | **99.2%** |
| Cov(log H, log E) | -0.00324 | — |
| Var(log DEI) | 0.6075 | 100% |
| H 的变异系数 (CV) | 3.9% | — |
| E 的变异系数 (CV) | 64.3% | — |

### 4.3 解读

**log(DEI) 的跨菜品差异中，99.2% 来自环境代价 E 的差异，仅 0.8% 来自味觉享受 H 的差异。** 这并非方法缺陷，而是反映了一个重要的实证发现：

> 在我们的 158 道菜样本中，菜品间的味觉享受差异极小（CV=3.9%），而环境代价差异极大（CV=64.3%）。换言之，大多数菜品都能提供类似水平的味觉满足，但环境代价天差地别。

这一发现本身即有重要的政策含义：**消费者无需牺牲太多口感即可大幅降低饮食的环境足迹**。

### 4.4 log(DEI) vs DEI_z 排名对比

两种标准化方法的 Spearman 秩相关：rho = 0.739。二者给出中等差异的排名，因为 Z-score 标准化将 H 和 E 强制等权（各占 50%），而 log 变换保留了原始方差结构。本文以 log(DEI) 为主规格，DEI_z 作为稳健性检验。

---

## 五、核心发现

### 5.1 log(DEI) 排名

**Top 10（最高效美味）**:

| 排名 | 菜品 | H 分 | E 值 | log(DEI) | 菜系 | 烹饪方式 |
|------|------|------|------|----------|------|----------|
| 1 | 泡菜 Kimchi | 7.18 | 0.011 | 6.500 | 韩国 | 生食 |
| 2 | 青木瓜沙拉 Papaya Salad | 7.19 | 0.011 | 6.498 | 泰国 | 生食 |
| 3 | 凉拌卷心菜 Coleslaw | 6.70 | 0.013 | 6.231 | 美国 | 生食 |
| 4 | 泰式冰茶 Thai Iced Tea | 7.22 | 0.024 | 5.691 | 泰国 | 冷加工 |
| 5 | 酸奶拌菜 Raita | 6.86 | 0.028 | 5.499 | 印度 | 生食 |
| 6 | 越式冰咖啡 Ca Phe Sua Da | 7.43 | 0.036 | 5.321 | 越南 | 冷加工 |
| 7 | 鳄梨酱 Guacamole | 6.93 | 0.035 | 5.297 | 墨西哥 | 生食 |
| 8 | 酸橘汁腌鱼 Ceviche | 7.30 | 0.039 | 5.222 | 墨西哥 | 生食 |
| 9 | 冷汤 Gazpacho | 7.44 | 0.040 | 5.218 | 西班牙 | 生食 |
| 10 | 塔布勒沙拉 Tabbouleh | 7.36 | 0.042 | 5.159 | 地中海 | 生食 |

**Bottom 10（最低效美味）**:

| 排名 | 菜品 | H 分 | E 值 | log(DEI) | 菜系 | 烹饪方式 |
|------|------|------|------|----------|------|----------|
| 149 | 穆萨卡 Moussaka | 7.12 | 0.517 | 2.624 | 地中海 | 烤 |
| 150 | 肋排 Ribs | 7.00 | 0.544 | 2.555 | 美国 | 烟熏 |
| 151 | 玛莎曼咖喱 Massaman Curry | 7.31 | 0.575 | 2.543 | 泰国 | 炖 |
| 152 | 汉堡 Hamburger | 6.71 | 0.550 | 2.501 | 美国 | 烤 |
| 153 | 千层面 Lasagna | 6.89 | 0.594 | 2.450 | 意大利 | 烤 |
| 154 | 韩式烤牛肉 Bulgogi | 7.38 | 0.662 | 2.411 | 韩国 | 烤 |
| 155 | 红酒炖牛肉 Beef Bourguignon | 7.34 | 0.816 | 2.197 | 法国 | 炖 |
| 156 | 牛排 Steak | 6.76 | 0.782 | 2.158 | 美国 | 烤 |
| 157 | 炖牛膝 Osso Buco | 7.17 | 0.934 | 2.038 | 意大利 | 炖 |
| 158 | 烟熏牛胸肉 Brisket | 7.05 | 0.979 | 1.974 | 美国 | 烟熏 |

**关键洞察**: log(DEI) 最高分 (6.500) 与最低分 (1.974) 之比约 3.3:1（对应原始 DEI 约 92 倍差距）。排名前列菜品全部为生食或冷加工的植物基食物/饮品，而底部菜品均为大量使用牛肉的高能耗烹饪菜肴。

### 5.2 Pareto 前沿分析

共识别 **7 道 Pareto 最优菜品**（在 H-E 二维空间中不被任何其他菜品同时支配）：

| 菜品 | H | E | log(DEI) | 优势 |
|------|---|---|----------|------|
| 泡菜 Kimchi | 7.18 | 0.011 | 6.500 | 极低 E |
| 青木瓜沙拉 Papaya Salad | 7.19 | 0.011 | 6.498 | 极低 E |
| 泰式冰茶 Thai Iced Tea | 7.22 | 0.024 | 5.691 | 低 E + 较高 H |
| 越式冰咖啡 Ca Phe Sua Da | 7.43 | 0.036 | 5.321 | 中低 E + 高 H |
| 冷汤 Gazpacho | 7.44 | 0.040 | 5.218 | 低 E + 高 H |
| 意式冰淇淋 Gelato | 7.56 | 0.065 | 4.760 | 高 H |
| 奶冻 Panna Cotta | 7.57 | 0.077 | 4.589 | 最高 H |

相较于原始 DEI 的 32 道 Pareto 最优菜品，log 空间下仅 7 道——这是因为 log 变换压缩了 E 的极端值，使得 Pareto 前沿更加精炼。前沿从 kimchi（极低 E）延伸到 panna cotta（最高 H=7.57），覆盖 5 个菜系。

### 5.3 "浪费空间" (Waste Space) 分析

- **157/158 道菜 (99.4%)** 存在更高效的替代品（H 不低于其值、但 E 更低）
- 平均可减少环境代价的幅度: 按菜品 E 值分布，中位约 **94%**
- 最大可减少 **98.9%**（烟熏牛胸肉 → 泡菜）
- 仅泡菜（Pareto 前沿端点）无更优替代

### 5.4 菜系维度分析

| 菜系 | 菜品数 | 平均 log(DEI) | 中位 log(DEI) | 平均 H | 平均 E | Pareto 占比 |
|------|--------|--------------|--------------|--------|--------|------------|
| 泰国 | 12 | 3.857 | 3.437 | 7.14 | 0.214 | 16.7% |
| 其他 | 7 | 3.833 | 3.972 | 7.03 | 0.205 | 0% |
| 日本 | 14 | 3.799 | 3.735 | 6.94 | 0.183 | 0% |
| 西班牙 | 5 | 3.710 | 3.318 | 7.32 | 0.220 | 20.0% |
| 越南 | 7 | 3.668 | 3.301 | 7.12 | 0.247 | 14.3% |
| 墨西哥 | 13 | 3.633 | 3.359 | 7.02 | 0.226 | 0% |
| 韩国 | 10 | 3.629 | 3.469 | 7.06 | 0.266 | 10.0% |
| 意大利 | 16 | 3.597 | 3.646 | 7.16 | 0.256 | 12.5% |
| 印度 | 14 | 3.589 | 3.420 | 7.10 | 0.219 | 0% |
| 地中海 | 12 | 3.468 | 3.286 | 7.30 | 0.271 | 0% |
| 中国 | 20 | 3.432 | 3.477 | 6.80 | 0.236 | 0% |
| 美国 | 18 | 3.329 | 3.329 | 6.94 | 0.338 | 0% |
| 法国 | 10 | 3.228 | 3.247 | 7.26 | 0.325 | 0% |

**发现**:
- 泰国菜平均 log(DEI) 最高 (3.86)，受青木瓜沙拉和冰茶的极低 E 驱动
- 日本菜平均 E 最低 (0.183)，但 H 分偏低导致 log(DEI) 仅排第三
- 法国菜和美国菜 log(DEI) 最低，前者因大量使用牛肉/黄油（高 E），后者因牛肉类菜品占比高
- Pareto 最优菜品分布于 5 个菜系（韩、泰、越、西、意），中国菜和法国菜均无 Pareto 最优

### 5.5 OLS 回归：log(DEI) 的决定因素

**主回归: log(DEI) = f(食材, 烹饪, 菜系)**

| 变量 | 系数 | t 值 | p 值 | 解读 |
|------|------|------|------|------|
| 常数项 | 5.912 | 21.0 | <0.001 | — |
| log(E_carbon) | **-0.233** | -6.5 | <0.001 | 碳排放翻倍 → log(DEI) 降 0.23 |
| log(E_water) | **-0.403** | -8.5 | <0.001 | 水足迹翻倍 → log(DEI) 降 0.40 |
| log(E_energy) | **-0.091** | -6.9 | <0.001 | 能耗翻倍 → log(DEI) 降 0.09 |
| method_steam | +0.406 | 4.5 | <0.001 | 蒸最优 |
| method_boil | +0.227 | 4.0 | <0.001 | 水煮次优 |
| method_simmer | +0.196 | 3.6 | <0.001 | 慢炖正向 |
| method_deep_fry | -0.194 | -3.5 | 0.001 | 油炸负向 |
| n_ingredients | +0.020 | 1.5 | 0.135 | 不显著 |
| total_grams | +0.0002 | 1.1 | 0.264 | 不显著 |

**模型 R² = 0.967**, Adj. R² = 0.960, F(30,127) = 125.5, p < 0.001。

**分解回归 R²**:
- 单独 log(E) 回归: R² = 0.967 → E 的结构性变量几乎完全解释 log(DEI)
- 单独 log(H) 回归: R² = 0.451 → H 的可解释方差较低，菜系效应（法国、地中海、西班牙）显著

**解读**: 水足迹 (E_water) 是最强负向预测变量（系数 -0.403），其次是碳排放 (-0.233) 和烹饪能耗 (-0.091)。蒸制方式最优（+0.406），油炸最差（-0.194）。菜系虚拟变量均不显著，说明在控制了食材和烹饪方式后，菜系本身不是 DEI 的独立预测变量。

---

## 六、敏感性分析

### 6.1 E 权重方案稳健性

测试 4 种 E 权重方案下 log(DEI) 排名的稳定性（Spearman 秩相关）：

| 方案对比 | Spearman rho |
|---------|-------------|
| 等权重 vs 碳优先 | > 0.99 |
| 等权重 vs 水优先 | > 0.98 |
| 等权重 vs 能耗优先 | > 0.97 |
| 碳优先 vs 水优先 | > 0.98 |
| 碳优先 vs 能耗优先 | > 0.94 |
| 水优先 vs 能耗优先 | > 0.94 |

**结论**: 所有方案对间 rho > 0.94，log(DEI) 排名对 E 权重选择**高度稳健**。

### 6.2 E 成分留一法敏感性

| 剔除成分 | Spearman rho | Kendall tau |
|---------|-------------|-------------|
| 碳排放 E_carbon | 0.809 | 0.637 |
| 水足迹 E_water | 0.925 | 0.778 |
| 能耗 E_energy | 0.809 | 0.636 |

**发现**: 剔除水足迹对排名影响最小 (rho=0.925)，剔除碳排放或能耗影响较大 (rho≈0.81)。碳排放和能耗是 DEI 差异的主要驱动子分量。

---

## 七、验证结果

### 7.1 七项验证测试汇总

| 测试 | 结果 | 状态 |
|------|------|------|
| H 分数收敛性 | n=200 时 CI=0.413, n=100 时 CI=0.594 | ✓ n≥200 收敛 |
| 代理 vs NLP H 相关性 | Pearson r=0.935 | ✓ **通过** |
| 预训练 vs 微调 H | r=0.891, 仅 4 道菜跨 quintile | ✓ **高度一致** |
| E 成分稳定性 | 最低 rho=0.809 (碳/能耗) | ✓ 可接受 |
| 蒙特卡罗排名稳定性 | 44.1% 模拟保持 ±3 名 | △ 中等稳定 |
| 菜系 ANOVA | eta²=0.054 (小效应), p=0.753 | ✓ 菜系效应弱 |
| 分半信度 | Spearman-Brown r=**0.916** | ✓ **Excellent** |

### 7.2 关键验证结论

1. **H 分数可靠性**: 分半信度 r=0.916（Excellent 级别），证明微调 BERT 在菜品间产生了高度稳定可复现的评分差异
2. **微调一致性**: 预训练 vs 微调 dish-level r=0.891，仅 4/158 道菜跨 quintile 变动，说明微调优化了精度但未颠覆排名
3. **代理方法一致性**: 星级代理 H 与 BERT H 的 r=0.935，说明即使用简单星级也能捕捉 87%+ 的味觉享受差异
4. **DEI 排名稳健**: 无论使用哪种 E 权重方案，排名几乎不变 (rho > 0.94)
5. **蒙特卡罗扰动**: 44.1% 在 ±3 名内。极端菜品（brisket 99.8%, beef bourguignon 99.5%, bulgogi 94.0%）排名高度稳定；中间区域菜品因密度高而排名波动较大（korma 18.6%），属预期行为
6. **菜系效应**: eta²=0.054，ANOVA p=0.753（不显著），Kruskal-Wallis p=0.676（不显著）。菜系对 log(DEI) 的解释力仅 5.4%，证实菜品个体差异远大于菜系间差异

---

## 八、方法学贡献

1. **首创 DEI 指标**: 文献中首次将食物味觉享受与环境代价整合为单一可比较指标，并使用 log 变换确保方法论严谨性
2. **领域微调 NLP**: 使用 LLM (DeepSeek v3.2) 标注 + BERT 微调的两阶段管线，将通用情感模型适配为食物味觉专用评分器 (dish r=0.844)
3. **方差分解透明性**: 首次量化 H vs E 对 DEI 方差的贡献（0.8% vs 99.2%），为 DEI 的解读提供了完整的方法论基础
4. **大规模 NLP 味觉提取**: 从 530 万条 Yelp 评论中提取 76,927 条菜品级味觉评分，覆盖 158 道菜
5. **Pareto 前沿框架**: 在 log(H)-log(E) 空间识别 7 道 Pareto 最优菜品，为"好吃且环保"的食物选择提供严格的多目标优化分析
6. **"浪费空间"量化**: 首次量化了现有饮食模式中 H 可保持但 E 可显著降低的空间 (中位约 94%)
7. **多维稳健性**: 7 项验证测试 + 4 种权重方案 + 1000 次蒙特卡罗模拟 + 留一法敏感性

---

## 九、局限性与下一步

### 当前局限

1. **H 方差小**: 微调 BERT 的 H 范围仅 [6.05, 7.57]（CV=3.9%），说明模型可能仍未充分捕捉菜品间的味觉差异。对数变换后 H 仅贡献 log(DEI) 方差的 0.8%，DEI 排名主要由 E 驱动
2. **代理偏差**: Yelp 评论可能仍混淆味道与整体用餐体验（尽管微调已部分缓解），地理覆盖偏向北美
3. **H 非正态**: Dish-level H 均值显著左偏 (D'Agostino p<0.001)，分布呈天花板效应
4. **回归残差**: log(DEI) 回归峰度仍偏高 (6.88)，存在少量离群点
5. **食谱标准化**: 部分菜品食谱基于典型做法估算，可能与实际餐厅用量有偏差
6. **蒙特卡罗中间区域**: 158 道菜中排名 50-110 区域密集，微小扰动易改变排名（44.1% 在 ±3 名内）

### 下一步计划

1. **H 信号增强**: 考虑 pairwise ranking 模型替代 pointwise regression，可能更好地捕捉菜品间的细微味觉差异
2. **Yelp 代理偏差控制**: 在回归中加入餐厅星级、价格档次、评论长度作为控制变量，提取"纯味觉"残差
3. **人工验证**: 完成 200 样本人工评分验证，量化 LLM-BERT 管线与人类判断的一致性
4. **地理分层**: 按城市/州分析 DEI 地域差异
5. **食谱验证**: 与 USDA FoodData Central 交叉验证食谱组成
6. **加权 DEI 探索**: 开发可调节 H vs E 权重的广义 DEI: log(DEI_w) = w·log(H) - (1-w)·log(E)，默认 w=0.5 时即为 DEI_z 的 log 空间等价

---

## 十、文件清单

| 文件 | 说明 |
|------|------|
| `code/01_explore_yelp.py` | Yelp 数据探索与预处理 |
| `code/01b_prepare_env_factors.py` | 食材环境因子数据库构建 |
| `code/02_extract_dishes.py` | 菜品提取（正则匹配 + 上下文提取） |
| `code/03_nlp_hedonic_scoring.py` | NLP 情感评分 + LLM 标注管线 |
| `code/03b_finetune_bert.py` | BERT 微调脚本（回归任务） |
| `code/03c_apply_finetuned.py` | 微调模型批量评分 |
| `code/04_env_cost_calculation.py` | 环境代价计算（158 道菜食谱） |
| `code/05_dei_computation.py` | DEI 计算 + 方差分解 + 核心分析 |
| `code/06_validation_robustness.py` | 验证与稳健性检验（7 项测试） |
| `code/config.py` | 全局配置 |
| `data/dish_DEI_scores.csv` | **158 道菜完整 DEI 数据**（含 log_DEI, DEI_z） |
| `data/dish_hedonic_scores.csv` | 158 道菜 H 分数（预训练 + 微调） |
| `data/dish_environmental_costs.csv` | 158 道菜 E 数据 |
| `data/dish_mentions_scored.parquet` | 76,927 条 NLP 评分 |
| `data/llm_annotations.parquet` | 1,896 条 LLM 标注 |
| `models/hedonic_bert_finetuned/` | 微调 BERT 模型权重 |
| `results/figures/dei_*.png` | 6 张核心图（含方差分解图） |
| `results/figures/validation_*.png` | 3 张验证图 |
| `results/tables/` | 回归结果、方差分解、菜系汇总、验证汇总等 |
