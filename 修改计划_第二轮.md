# DEI 论文第二轮修改计划

## 批评总览

| 编号 | 批评 | 核心问题 | 严重程度 |
|------|------|----------|----------|
| C6 | 存活偏差 (Survivorship Bias) | Yelp上出现的菜经过市场筛选，4% CV可能是选择效应 | 高 |
| C7 | 比较单位问题 (Apples vs Oranges) | rojak vs brisket的345倍比较是配菜vs主菜 | 高 |
| C8 | "好吃"定义过度简化 | 遗漏饱腹感、满足感、文化意义、社交场景 | 中 |
| C9 | 精致化曲线因果推断弱 | α≈0可能是BERT分辨率不够而非真正无差异 | 中 |
| C10 | 样本偏差 | Yelp偏向美国年轻城市群体 | 中 |

---

## C6: 存活偏差 — "你测的是幸存者"

### 问题本质
能出现在Yelp上的334道菜经历了双重筛选：(1) 餐厅决定放上菜单，(2) 食客决定写评论。难吃的菜在第一关就被淘汰。因此4% CV反映的是"幸存者之间的差异"，如果包含被淘汰的菜，真实CV可能远高于4%。

### 分析方案：`code/13a_survivorship_bias.py`

**A. 量化存活筛选强度**
- 从dish_mentions.parquet统计每道菜的提及次数分布
- 计算"提及不等式"：是否少数菜占据大部分提及？Gini系数？
- 按提及频次分组（高频>500, 中频100-500, 低频<100），比较各组H的CV
- 逻辑：如果低频菜（更边缘的市场存在）有更高H变异，说明存活筛选确实压缩了H

**B. 存活偏差边界分析 (Bounds Analysis)**
- 思路：假设被市场淘汰的菜有系统性更低的H
- 模拟：在现有334道菜基础上，添加K道"幽灵菜"（ghost dishes），H服从 H_ghost ~ N(μ_low, σ_high)
- μ_low = 现有最低H - Δ, σ_high 从文献估计
- 参数扫描：K ∈ {50, 100, 200, 500}, Δ ∈ {0.5, 1.0, 1.5, 2.0}
- 对每个(K, Δ)组合重新计算Var(log DEI)中H的贡献比例
- 找到"翻转点"：需要多少幽灵菜、质量多差，才能让H贡献超过10%/20%/50%
- **关键输出**：一张热力图，x=幽灵菜数量，y=H下降幅度，色=H方差贡献%

**C. 与食品科学文献对比**
- 收集文献中的菜品hedonic CV数据（感官面板实验），已知约20%
- 但文献面板通常包含"差的配方变体"（如减盐50%版本），不代表市场上的菜
- 论证：即使在包含差变体的实验中，CV也只有20%——而我们的敏感性分析（11a）已覆盖此范围

**D. Yelp星级作为筛选强度代理**
- 高星餐厅的菜 vs 低星餐厅的菜：H的CV是否不同？
- 如果低星餐厅的菜展示更高H变异，可间接支持存活筛选假说

### 预期输出
- `results/tables/survivorship_bounds.csv` — 边界分析参数扫描
- `results/figures/survivorship_heatmap.png` — 翻转点热力图
- `results/figures/mention_frequency_vs_h_cv.png` — 提及频次与H变异关系

### 对结论的影响
**大概率影响有限**。即使CV=20%（11a已证明），E仍贡献91.5%。要让存活偏差颠覆结论，需要>300道被淘汰的菜且H极低(< 4分)——这在现实中不太可能（菜单上的菜通常至少中等好吃）。

---

## C7: 比较单位问题 — "苹果和橘子"

### 问题本质
全文最醒目的数字（rojak比brisket好345倍）是配菜vs主菜的比较。实际饮食决策是"今晚主菜吃什么"，不是"用泡菜替代牛排"。虽然11d已做了类内分析，但论文的叙事结构仍以全局比较为主。

### 分析方案：`code/13b_meal_level_analysis.py`

**A. 餐级DEI分析 (Meal-Level DEI)**
- 定义标准餐结构：Main (400-800 kcal) + Side (100-300 kcal) + Drink (100-300 kcal)
- 从334道菜中按meal_role分组，枚举所有合理的三件套组合
- 约束条件：
  - 总热量 800-1200 kcal
  - 蛋白质 ≥ 25g
  - 来自同一或兼容菜系（可选）
- 计算餐级 DEI_meal = H_meal / E_meal，其中 H_meal = 加权平均H，E_meal = 总E
- **关键输出**：最高DEI餐 vs 最低DEI餐的差距，以及方差分解

**B. 同功能对比 (Like-for-Like)**
- 在每个meal_role内部独立做方差分解：
  - Full Main (154道): H贡献%? E贡献%?
  - Heavy Main (121道): H贡献%? E贡献%?
  - Side/Snack (11道): H贡献%? E贡献%?
- 重点展示 Full Main 之间的排名和DEI分布
- **关键输出**：表格展示每个功能角色内的方差分解

**C. 重新包装标题数字**
- 不再用 "rojak vs brisket 345倍"，改用：
  - "在主菜中，鸡肉菜(DEI~3.5) vs 牛肉菜(DEI~2.5) 差2.7倍"
  - "在同一蛋白质类别内，替代也能达到60%+ E削减"
- 计算主菜类别内的最高/最低DEI比值
- **关键输出**：within-role DEI range 和 substitution potential

**D. 热量等价替代 (Calorie-Equivalent Substitution)**
- 找到热量相近(±100kcal)的配对，限定在同功能角色内
- 计算这些"公平比较"中的E节省空间
- **关键输出**：热量等价替代网络图

### 预期输出
- `results/tables/meal_level_dei.csv` — 餐级DEI排名
- `results/tables/within_role_variance.csv` — 按功能角色的方差分解
- `results/figures/meal_dei_distribution.png` — 餐级DEI分布
- `results/figures/like_for_like_comparison.png` — 同功能对比图

### 对结论的影响
**核心结论不变，但表述需要调整**。预计主菜内部的H CV仍然<<E CV，但差距可能不是16倍而是8-12倍。论文叙事应从"全局345倍"转向"同功能角色内仍有巨大环境优化空间"。

---

## C8: "好吃"定义过度简化 — "不只是味道"

### 问题本质
BERT的H分数只捕捉了评论文本中的"味觉享受"信号。但人们选择食物还考虑饱腹感、满足感、文化/情感意义、社交适宜性。一碗木瓜沙拉的"味道"可能很好，但"吃完还饿"的问题没被捕捉。

### 分析方案：`code/13c_multidimensional_hedonic.py`

**A. 文本信号提取 — 饱腹感指数 (Satiety Signal)**
- 从dish_mentions_scored.parquet的context_text中提取饱腹感关键词
- 正向词："filling", "hearty", "satisfying", "comfort", "substantial", "rich"
- 负向词："light", "refreshing", "small portion", "still hungry", "snack"
- 计算每道菜的 Satiety Index (SI) = (正向词频 - 负向词频) / 总词频
- **预期**：牛肉菜SI高，沙拉类SI低

**B. 多维H分解**
- H_taste = 现有BERT分数（味觉享受）
- H_satiety = 上述SI指数（饱腹满足）
- H_composite = w1·H_taste + w2·H_satiety
- 扫描 w2 ∈ {0.1, 0.2, 0.3, 0.5}
- 重新计算DEI_composite并与原始DEI比较
- **关键输出**：不同w2下DEI排名的ρ变化

**C. 情感价值分析 (Comfort/Nostalgia Signal)**
- 提取"comfort food", "remind me of", "grandma", "childhood", "home", "soul", "craving"等关键词
- 计算 Emotional Index (EI)
- 探索：是否高EI菜倾向高E（"comfort food = 高热量高成本"假说）

**D. 场景适宜性分析**
- 分析评论中的场景词："date night", "quick lunch", "special occasion", "everyday meal"
- 按场景分类后，各场景下的DEI排名是否不同？
- **预期**：特殊场合菜更偏向高E，日常菜更偏向高DEI

### 预期输出
- `results/tables/multidimensional_hedonic.csv` — 多维H分数
- `results/tables/satiety_by_dish.csv` — 饱腹感指数
- `results/figures/h_satiety_scatter.png` — H_taste vs H_satiety
- `results/figures/dei_sensitivity_to_satiety.png` — DEI排名随w2变化

### 对结论的影响
**中等影响**。加入饱腹感后，肉类主菜的综合H会上升，植物配菜的综合H可能下降。DEI排名会有更多重排，但E的方差贡献大概率仍占主导（因为E的CV=64%，而增加一个额外维度的变异远不够平衡）。这个分析的价值在于**诚实承认单维H的局限性并量化其影响**。

---

## C9: 精致化曲线因果推断弱 — "BERT测不出细微差异"

### 问题本质
在beef家族中，hamburger到beef bourguignon的H差距只有0.66分（6.71→7.38）。这可能是因为：
(a) 真的没有口味差异（论文的论点），或
(b) BERT评分在这个分辨率下不可靠。

去过高级餐厅的人能感知到wagyu牛排 vs 普通牛排的区别，但这种区别可能被粗粒度的Yelp评论抹平了。

### 分析方案：`code/13d_refinement_resolution.py`

**A. BERT最小可检测差异 (MDD)**
- 对每对dish A vs dish B，计算 t = (H_A - H_B) / sqrt(SE_A² + SE_B²)
- SE = SD / sqrt(n_mentions)
- 统计同家族内有多少dish pair的H差异是统计显著的（p < 0.05 Bonferroni）
- 如果大部分pair在BERT精度内不可区分，则α≈0的结论不可信
- **关键输出**：可区分比例 vs 不可区分比例

**B. 效应量分析 (Cohen's d)**
- 计算每个家族内所有dish pair的Cohen's d
- d < 0.2 = 可忽略差异，0.2-0.5 = 小差异，0.5-0.8 = 中等差异
- 如果大部分pair的d < 0.2，则BERT确实"分不出来"
- 但如果一些pair的d > 0.5且α仍≈0，则精致化确实不增加H

**C. 跨平台验证精致化曲线**
- 使用cross_platform_h_scores.csv中的Google/TripAdvisor数据
- 对有跨平台数据的dish family，分别用三个平台的H拟合精致化曲线
- 如果三个平台的α都≈0，则排除"BERT分辨率不够"的解释
- **关键输出**：三平台α对比表

**D. 价格层级作为精致化代理**
- 从restaurants.parquet提取价格层级（$, $$, $$$, $$$$）
- 同一道菜在不同价格层级餐厅的H是否不同？
- 如果$$$$餐厅的brisket H > $餐厅的brisket H，说明精致化确实提升了感知H
- 如果无差异，支持"精致化不增H"的结论
- **关键输出**：价格层级 × H 的交互分析

**E. 文献三角验证**
- 搜索感官科学文献中"食材升级vs口味改善"的实验数据
- 特别关注：有机vs普通，premium cut vs standard cut
- 已有研究表明盲品测试中消费者经常分不出premium和standard
- 在论文Discussion中引用

### 预期输出
- `results/tables/within_family_mdd.csv` — 最小可检测差异
- `results/tables/cross_platform_refinement.csv` — 跨平台精致化比较
- `results/tables/price_tier_h_analysis.csv` — 价格层级H分析
- `results/figures/refinement_resolution_diagnostic.png` — MDD诊断图

### 对结论的影响
**这是精致化曲线概念成败的关键**。如果BERT能区分family内的大部分pair但α仍≈0，结论成立。如果大部分pair在统计上不可区分，需要诚实地将精致化曲线降级为"初步观察"而非确定性发现，并明确在Methods中说明测量分辨率限制。价格层级分析可以提供独立验证路径。

---

## C10: 样本偏差 — "Yelp不代表世界"

### 问题本质
Yelp用户偏向美国年轻城市群体。14个州608个城市，其中Philadelphia/Tampa/Indianapolis占大头。这样的样本能代表全球消费者偏好吗？

### 分析方案：`code/13e_geographic_demographic.py`

**A. 地理集中度量化**
- 统计每个州/城市的餐厅数和提及数
- Gini系数量化地理集中度
- 绘制热力图：state × cuisine的提及密度

**B. 城市级H稳定性**
- 选取提及数>1000的top 10城市
- 分别计算每个城市的dish-level H
- 跨城市H的Spearman ρ：如果不同城市给同一道菜的H相近，则地理偏差影响小
- **关键输出**：城市间H一致性矩阵

**C. 价格层级分层**
- 从restaurant attributes提取price_range
- 按价格分层(1-4)重新计算DEI
- 如果高价餐厅和低价餐厅给出的dish H排名一致，则SES偏差有限

**D. 菜系代表性分析**
- 334道菜跨29菜系，但每个菜系的提及来源可能集中在特定城市
- 检查：Thai菜的评分主要来自哪些城市？Korean呢？
- 如果某菜系的评分来自<3个城市，标记为"地理代表性低"

**E. 人口统计学框架**
- 用Census数据估算Yelp覆盖城市的中位收入、年龄分布、种族多样性
- 作为生态学推断（非个体级别），说明样本偏向哪类社区
- 在论文Limitations中明确说明

### 预期输出
- `results/tables/geographic_concentration.csv` — 地理集中度
- `results/tables/city_h_consistency.csv` — 城市间H一致性
- `results/figures/geographic_heatmap.png` — 地理分布热力图
- `results/figures/city_h_stability.png` — 城市间H稳定性矩阵

### 对结论的影响
**对核心结论（E主导DEI）影响小，对外推性(generalizability)影响大**。H的压缩在不同城市内部应该一致（因为是方法论特征），所以E主导的结论不太可能受地理偏差影响。但"全球菜系排名"的推广性确实受限——这需要在论文中明确限定适用范围。

---

## 实施方案

### 脚本依赖图

```
13a (存活偏差) ──────────────┐
13b (餐级分析) ──────────────┤
13c (多维H)   ──────────────┤──→ 14_integration.py → paper/main.tex
13d (精致化验证) ────────────┤
13e (地理人口)  ──────────────┘
```

- 13a-13e 之间无依赖，可完全并行
- 14_integration.py 汇总所有输出

### 文件命名

| 脚本 | 功能 | 预计运行时间 |
|------|------|-------------|
| `code/13a_survivorship_bias.py` | 存活偏差边界分析 | ~3 min |
| `code/13b_meal_level_analysis.py` | 餐级DEI + 同功能对比 | ~2 min |
| `code/13c_multidimensional_hedonic.py` | 饱腹感/情感/场景文本分析 | ~10 min (文本扫描) |
| `code/13d_refinement_resolution.py` | MDD + 跨平台 + 价格层级 | ~5 min |
| `code/13e_geographic_demographic.py` | 地理集中度 + 城市一致性 | ~5 min |
| `code/14_integration_round2.py` | 汇总+论文更新数据 | ~1 min |

### 论文修改策略

**Abstract**: 无需大改，加入一句关于样本范围的限定。

**Results 修改**:
1. 将"rojak vs brisket 345x"从显要位置移除，改为在同功能比较后附带提及
2. 新增"Meal-level analysis"小节（13b输出）
3. 修改"Within-category"小节，强调同功能角色比较
4. 新增"Multi-dimensional hedonic assessment"小节（13c输出）
5. 修改"Refinement cost curve"小节，加入MDD分析和因果推断限定

**Robustness 新增**:
1. "Survivorship bias bounds" — 翻转点分析（13a输出）
2. "Geographic robustness" — 城市间一致性（13e输出）
3. 更新"Proxy bias"节，加入价格层级分析（13d输出）

**Discussion 修改**:
1. Limitations: 加入存活偏差、样本覆盖范围限定
2. 加入"hedonic measurement scope"讨论，明确H测的是什么不是什么
3. 精致化曲线降低因果推断力度，改为"suggestive evidence"
4. 加入"future work"关于人工品鉴验证的需求

**Methods 新增**:
1. 饱腹感指数计算方法
2. 餐级DEI计算方法
3. 最小可检测差异方法
4. 城市间一致性检验方法

---

## 风险评估

| 风险 | 概率 | 影响 | 应对 |
|------|------|------|------|
| 饱腹感加入后DEI排名大幅重排 | 中 | 高 | 扫描w2权重，展示稳健区间 |
| MDD分析显示BERT分辨不了家族内差异 | 高 | 中 | 诚实报告，降级精致化曲线为"初步发现" |
| 地理分析显示H在不同城市差异大 | 低 | 高 | 加入城市固定效应控制 |
| 存活偏差翻转点出现在合理范围内 | 低 | 高 | 强调这是上界分析，实际翻转不太可能 |
| 餐级分析发现肉类餐DEI优势缩小 | 中 | 中 | 不改变核心发现，仅调整幅度 |

---

## 预期对核心结论的影响

**不变的**：E主导DEI方差（即使加入所有修正，E贡献大概率>80%）

**需要调整的**：
1. 标题数字从"345倍"改为更保守的同功能比较（如"主菜间2-3倍"）
2. 精致化曲线从"确定性发现"降为"支持性证据"
3. 明确限定适用范围：美国城市餐厅场景，非全球通用
4. H的含义从"好吃程度"精确化为"Yelp评论者表达的食物味觉满意度"
5. 加入"综合食物价值 = 味觉 + 饱腹 + 文化"的框架，H是其中一个维度
